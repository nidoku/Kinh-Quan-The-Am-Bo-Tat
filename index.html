<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="light" />
  <title>Kinh Quán Thế Âm Bồ Tát</title>
  <meta name="description" content="Toàn bộ kinh trì chú : "Kinh Bạch Y Cứu Khổ – Chú Đại Bi – Chú Chuẩn Đề – Bát Nhã Tâm Kinh", và file PDF để tải về." />

  <style>
    :root{
      --bg0:#f4faff;
      --bg1:#ffffff;
      --ink:#0b1220;
      --muted:#5b677a;
      --card:#ffffff;
      --border:#e6eef7;
      --shadow: 0 18px 50px rgba(15, 23, 42, .08);
      --accent:#2563eb;
      --accent2:#1d4ed8;
      --radius:20px;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--ink);
      background:
        radial-gradient(1200px 500px at 15% 0%, rgba(37,99,235,.14), transparent 55%),
        radial-gradient(900px 450px at 85% 10%, rgba(14,165,233,.10), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      line-height:1.7;
    }
    .wrap{max-width:1100px;margin:0 auto;padding:28px 16px 60px;}
    .hero{
      border:1px solid var(--border);
      background:rgba(255,255,255,.78);
      backdrop-filter: blur(10px);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:22px;
    }
    .heroGrid{
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap:18px;
      align-items:center;
    }
    @media (max-width: 900px){ .heroGrid{grid-template-columns:1fr} .cover{max-width:260px} }
    h1{margin:0 0 6px;font-size:34px;line-height:1.2;}
    .sub{margin:0 0 16px;color:var(--muted);font-size:15px;}
    .actions{display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      padding:10px 14px;border-radius:14px;border:1px solid var(--border);
      background:#fff;text-decoration:none;font-weight:800;font-size:14px;cursor:pointer;
      box-shadow: 0 10px 25px rgba(15, 23, 42, .06);
    }
    .btn.primary{
      background:linear-gradient(180deg, var(--accent), var(--accent2));
      color:#fff;border-color:transparent;
      box-shadow: 0 14px 30px rgba(37,99,235,.22);
    }
    .status{margin-left:auto;color:var(--muted);font-size:13px;font-weight:700;}
    .coverWrap{display:flex;justify-content:center;align-items:center;}
    .cover{
      width:100%;max-width:320px;border-radius:18px;border:1px solid var(--border);
      background:#fff;box-shadow:var(--shadow);padding:14px;
    }
    .cover img{width:100%;height:auto;display:block;border-radius:14px;background:#fff;}
    .coverCap{margin-top:10px;font-size:12px;color:var(--muted);text-align:center;}

    .main{
      margin-top:18px;border:1px solid var(--border);
      background:rgba(255,255,255,.92);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .mainHead{
      padding:16px 20px;border-bottom:1px solid var(--border);
      display:flex;align-items:center;gap:10px;
    }
    .mainHead h2{margin:0;font-size:16px;}
    .pages{padding:16px 20px 22px; display:grid; gap:14px;}
    .page{
      border:1px solid var(--border);
      background:#fff;
      border-radius:16px;
      padding:10px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, .05);
    }
    canvas{width:100%;height:auto;display:block;border-radius:12px;}
    .err{padding:12px 20px 20px;color:#b42318;font-weight:700;white-space:pre-wrap;}
    footer{
      margin-top:14px;color:var(--muted);font-size:12px;
      display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;
    }
    .credit{font-weight:900;color:#334155;}
  </style>
</head>

<body>
  <div class="wrap">
    <header class="hero">
      <div class="heroGrid">
        <div>
          <h1>Thỉnh kinh Quán Thế Âm Bồ Tát</h1>
          <p class="sub">Landing page render trực tiếp PDF (bố cục + hình ảnh đúng như file) và có file PDF để tải về.</p>

          <div class="actions">
            <a class="btn primary" href="Kinh-Bach-Y-Cuu-Kho.pdf" download>Tải PDF</a>
            <a class="btn" href="Kinh-Bach-Y-Cuu-Kho.pdf" target="_blank" rel="noopener">Mở PDF tab mới</a>
            <button class="btn" id="copy" type="button">Copy link</button>
            <a class="btn" id="fb" target="_blank" rel="noopener">Share Facebook</a>
            <div class="status" id="status">Ready</div>
          </div>
        </div>

        <div class="coverWrap">
          <div class="cover">
            <img src="cover-quan-am.png" alt="Bìa Quán Thế Âm Bồ Tát" />
            <div class="coverCap">Quán Thế Âm Bồ Tát</div>
          </div>
        </div>
      </div>
    </header>

    <main class="main">
      <div class="mainHead">
        <h2>PDF render</h2>
      </div>
      <div class="pages" id="pages"></div>
      <div class="err" id="error"></div>
    </main>

    <footer>
      <div>© Nội dung theo bản PDF.</div>
      <div class="credit">Thạnh Vương</div>
    </footer>
  </div>

  <script type="module">
    const PDF_URL = "Kinh-Bach-Y-Cuu-Kho.pdf";

    const statusEl = document.getElementById("status");
    const pagesEl  = document.getElementById("pages");
    const errEl    = document.getElementById("error");
    const copyBtn  = document.getElementById("copy");
    const fbLink   = document.getElementById("fb");

    const pageUrl = () => window.location.href.split("#")[0];
    fbLink.href = "https://www.facebook.com/sharer/sharer.php?u=" + encodeURIComponent(pageUrl());

    copyBtn.addEventListener("click", async () => {
      try { await navigator.clipboard.writeText(pageUrl()); statusEl.textContent = "Copied"; }
      catch { statusEl.textContent = "Copy failed"; }
      setTimeout(()=>statusEl.textContent="Ready", 900);
    });

    const setStatus = (t) => statusEl.textContent = t;

    // Bỏ bản min + chuyển CDN; đồng thời disableWorker để né lỗi worker/module trên Pages
    const PDFJS = "https://unpkg.com/pdfjs-dist@4.2.67/build/pdf.mjs";

    try{
      setStatus("Loading PDF.js…");
      const pdfjsLib = await import(PDFJS);

      setStatus("Loading PDF…");
      const loadingTask = pdfjsLib.getDocument({ url: PDF_URL, disableWorker: true });
      const pdf = await loadingTask.promise;

      const total = pdf.numPages;
      setStatus(`Rendering ${total} pages…`);

      for(let i=1;i<=total;i++){
        const page = await pdf.getPage(i);

        const wrapper = document.createElement("div");
        wrapper.className = "page";
        const canvas = document.createElement("canvas");
        wrapper.appendChild(canvas);
        pagesEl.appendChild(wrapper);

        const containerWidth = wrapper.clientWidth - 2;
        const baseViewport = page.getViewport({ scale: 1 });
        const scale = containerWidth / baseViewport.width;

        const dpr = Math.max(1, window.devicePixelRatio || 1);
        const viewport = page.getViewport({ scale: scale * dpr });

        const ctx = canvas.getContext("2d", { alpha:false });
        canvas.width = Math.floor(viewport.width);
        canvas.height = Math.floor(viewport.height);
        canvas.style.width = (viewport.width / dpr) + "px";
        canvas.style.height = (viewport.height / dpr) + "px";

        await page.render({ canvasContext: ctx, viewport }).promise;
        setStatus(`Rendered ${i}/${total}`);
      }

      setStatus("Done");
    }catch(e){
      errEl.textContent = String(e?.message || e) + "\n\n" + String(e?.stack || "");
      setStatus("Error");
    }
  </script>
</body>
</html>
